# afl (foundation library)
# used for all new stuff
inherit:
  - copy

depends:
  - libs::cxxtest

checkoutVars: [CVSROOT]
checkoutSCM:
  scm: cvs
  cvsroot: ${CVSROOT}
  module: afl

multiPackage:
  # Regular binary package
  bin:
    inherit: [make, buildsys]
    buildVars: [TARGET]
    buildScript: |
      doGenerate IN="$1" CXXTESTDIR="${BOB_DEP_PATHS[libs::cxxtest]}" TARGET="${TARGET:-POSIX}"
      doMake
      doMake test
      doMake install

    packageScript: |
      shallowCopy "$1/result" .

  # Coverage report
  # # FIXME: incomplete
  # cov:
  #   inherit: [make, buildsys]
  #   buildScript: |
  #     # Build with coverage enabled
  #     doGenerate IN="$1" CXXTESTDIR="${BOB_DEP_PATHS[libs::cxxtest]}" TARGET="${TARGET:-POSIX}" --with-coverage
  #     doMake
  #
  #   packageScript: |
  #     true

  # Documentation
  doxy:
    inherit: [doxygen]
    buildScript: |
      buildDoxygen "$1"

    packageScript: |
      packageDoxygen "$1"

  # Tags
  tags:
    # This is architecture-less and thus must NOT depend on CC, CFLAGS, etc.
    depends:
      - tools::buildsys
    buildScript: |
      perl "$2"/Make.pl IN="$1" OUT="." CXXTESTDIR="${BOB_DEP_PATHS[libs::cxxtest]}"
      make tags

    packageScript: |
      cp "$1/TAGS" .
